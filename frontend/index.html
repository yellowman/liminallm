<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LiminalLM Chat</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <script defer src="/static/chat.js"></script>
  </head>
  <body>
    <div class="app-shell">
      <header class="topbar">
        <div class="brand">
          <span class="spark"></span>
          <span>LiminalLM Chat</span>
        </div>
        <div class="bar-actions">
          <a href="/admin" id="admin-link" aria-label="Admin console">Admin</a>
          <button id="logout" class="ghost">Sign out</button>
        </div>
      </header>

      <main class="layout-with-sidebar">
        <!-- Left Sidebar: Conversations -->
        <aside class="sidebar" id="conversations-sidebar">
          <div class="sidebar-header">
            <h3>Conversations</h3>
            <button class="icon-btn" id="new-conversation-btn" title="New conversation">+</button>
          </div>
          <div class="sidebar-search">
            <input type="text" id="conversation-search" placeholder="Search conversations..." />
          </div>
          <div id="conversation-list" class="conversation-list">
            <div class="empty">Sign in to see conversations</div>
          </div>
        </aside>

        <!-- Main Content Area -->
        <div class="main-content">
          <!-- Auth Panel (shown when not logged in) -->
          <section class="panel" id="auth-panel">
            <!-- Login Form -->
            <div id="login-form-container">
              <h2>Sign in</h2>
              <p class="subtext">Use your account to start or resume conversations.</p>
              <form id="auth-form">
                <div class="field">
                  <label for="email">Email</label>
                  <input type="email" id="email" name="email" placeholder="you@example.com" required />
                </div>
                <div class="field">
                  <label for="password">Password</label>
                  <input type="password" id="password" name="password" placeholder="••••••••" required />
                </div>
                <div class="field">
                  <label for="mfa">MFA code (if required)</label>
                  <input type="text" id="mfa" name="mfa" placeholder="123456" inputmode="numeric" />
                </div>
                <div class="field">
                  <label for="tenant">Tenant (optional)</label>
                  <input type="text" id="tenant" name="tenant" placeholder="tenant-123" />
                </div>
                <div class="form-actions">
                  <button class="primary" type="submit" id="auth-submit">Continue</button>
                  <div class="small" id="status" aria-live="polite"></div>
                </div>
              </form>
              <div class="auth-links">
                <button type="button" class="link-btn" id="show-signup">Create an account</button>
                <button type="button" class="link-btn" id="show-reset">Forgot password?</button>
              </div>

              <!-- OAuth Providers -->
              <div class="oauth-divider">
                <span>or continue with</span>
              </div>
              <div class="oauth-buttons">
                <button type="button" class="oauth-btn" data-provider="google" id="oauth-google">
                  <svg viewBox="0 0 24 24" width="18" height="18">
                    <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                  </svg>
                  Google
                </button>
                <button type="button" class="oauth-btn" data-provider="github" id="oauth-github">
                  <svg viewBox="0 0 24 24" width="18" height="18">
                    <path fill="currentColor" d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                  </svg>
                  GitHub
                </button>
                <button type="button" class="oauth-btn" data-provider="microsoft" id="oauth-microsoft">
                  <svg viewBox="0 0 24 24" width="18" height="18">
                    <path fill="#F25022" d="M1 1h10v10H1z"/>
                    <path fill="#00A4EF" d="M13 1h10v10H13z"/>
                    <path fill="#7FBA00" d="M1 13h10v10H1z"/>
                    <path fill="#FFB900" d="M13 13h10v10H13z"/>
                  </svg>
                  Microsoft
                </button>
              </div>
              <div id="oauth-status" class="small" role="status"></div>
            </div>

            <!-- Signup Form -->
            <div id="signup-form-container" class="hidden">
              <h2>Create account</h2>
              <p class="subtext">Sign up to start using LiminalLM.</p>
              <form id="signup-form">
                <div class="field">
                  <label for="signup-email">Email</label>
                  <input type="email" id="signup-email" name="email" placeholder="you@example.com" required />
                </div>
                <div class="field">
                  <label for="signup-password">Password</label>
                  <input type="password" id="signup-password" name="password" placeholder="••••••••" minlength="8" required />
                </div>
                <div class="field">
                  <label for="signup-confirm">Confirm password</label>
                  <input type="password" id="signup-confirm" name="confirm" placeholder="••••••••" required />
                </div>
                <div class="field">
                  <label for="signup-tenant">Tenant (optional)</label>
                  <input type="text" id="signup-tenant" name="tenant" placeholder="tenant-123" />
                </div>
                <div class="form-actions">
                  <button class="primary" type="submit" id="signup-submit">Create account</button>
                </div>
              </form>
              <div id="signup-status" class="small" role="status"></div>
              <div class="auth-links">
                <button type="button" class="link-btn" id="show-login-from-signup">Already have an account? Sign in</button>
              </div>
            </div>

            <!-- Password Reset Form -->
            <div id="reset-form-container" class="hidden">
              <h2>Reset password</h2>
              <p class="subtext">Enter your email to receive a reset code.</p>
              <form id="reset-request-form">
                <div class="field">
                  <label for="reset-email">Email</label>
                  <input type="email" id="reset-email" name="email" placeholder="you@example.com" required />
                </div>
                <div class="form-actions">
                  <button class="primary" type="submit" id="reset-request-submit">Send reset code</button>
                </div>
              </form>
              <div id="reset-code-section" class="hidden">
                <div class="divider"></div>
                <p class="subtext">Enter the code sent to your email and your new password.</p>
                <form id="reset-confirm-form">
                  <div class="field">
                    <label for="reset-code">Reset code</label>
                    <input type="text" id="reset-code" name="code" placeholder="Enter code from email" required />
                  </div>
                  <div class="field">
                    <label for="reset-new-password">New password</label>
                    <input type="password" id="reset-new-password" name="password" placeholder="••••••••" minlength="8" required />
                  </div>
                  <div class="form-actions">
                    <button class="primary" type="submit" id="reset-confirm-submit">Reset password</button>
                  </div>
                </form>
              </div>
              <div id="reset-status" class="small" role="status"></div>
              <div class="auth-links">
                <button type="button" class="link-btn" id="show-login-from-reset">Back to sign in</button>
              </div>
            </div>

            <div id="error-banner" role="alert"></div>
          </section>

          <!-- Tab Navigation -->
          <nav class="tab-nav" id="main-tabs" aria-label="Main navigation">
            <button class="tab-btn active" data-tab="chat-tab" aria-selected="true">Chat</button>
            <button class="tab-btn" data-tab="contexts-tab" aria-selected="false">Contexts</button>
            <button class="tab-btn" data-tab="artifacts-tab" aria-selected="false">Artifacts</button>
            <button class="tab-btn" data-tab="tools-tab" aria-selected="false">Tools</button>
            <button class="tab-btn" data-tab="insights-tab" aria-selected="false">Insights</button>
            <button class="tab-btn" data-tab="settings-tab" aria-selected="false">Settings</button>
          </nav>

          <!-- Chat Tab -->
          <section class="tab-panel active" id="chat-tab" aria-label="Chat workspace">
            <div class="panel chat-panel">
              <div class="conversation-header">
                <div class="badge">
                  <span class="dot"></span>
                  <span id="conversation-label">New conversation</span>
                </div>
                <div class="pill-row">
                  <button class="ghost" id="new-thread">New thread</button>
                  <button class="minor" id="refresh-conversations">Refresh history</button>
                </div>
              </div>
              <div class="subtext">
                Provide an optional context ID to ground retrieval-augmented answers and a workflow ID to steer execution.
              </div>
              <div class="input-grid">
                <div class="field compact">
                  <label for="context-id">Context ID</label>
                  <select id="context-id">
                    <option value="">No context</option>
                  </select>
                </div>
                <div class="field compact">
                  <label for="workflow-id">Workflow ID</label>
                  <input type="text" id="workflow-id" placeholder="workflow.chat..." />
                </div>
              </div>

              <section class="panel-section collapsed" id="upload-section" aria-label="Upload files">
                <div class="section-header clickable" id="upload-section-toggle">
                  <h3>Upload knowledge <span class="toggle-icon">+</span></h3>
                </div>
                <div class="section-content">
                  <p class="subtext">
                    Attach files to a context before asking questions. Leave Context ID blank to keep uploads private.
                  </p>
                  <div class="input-grid">
                    <div class="field compact">
                      <label for="upload-context-id">Context ID</label>
                      <select id="upload-context-id">
                        <option value="">Private (no context)</option>
                      </select>
                    </div>
                    <div class="field compact">
                      <label for="upload-chunk-size">Chunk size (optional)</label>
                      <input type="number" id="upload-chunk-size" placeholder="512" min="64" max="4000" step="64" />
                    </div>
                  </div>
                  <div class="field">
                    <label for="file-upload">File</label>
                    <input type="file" id="file-upload" aria-describedby="file-upload-hint" />
                    <div class="small" id="file-upload-hint"></div>
                  </div>
                  <div class="pill-row">
                    <button type="button" class="minor" id="upload-file-btn">Upload file</button>
                  </div>
                  <div class="small" id="file-upload-status" role="status"></div>
                </div>
              </section>

              <div id="messages" aria-live="polite"></div>
              <div id="messages-empty" class="empty">Start a new thread to see your conversation history here.</div>

              <form id="chat-form">
                <div class="field textarea-wrap">
                  <label for="message-input">Message</label>
                  <textarea id="message-input" placeholder="Ask anything..." rows="3"></textarea>
                  <div class="draft-indicator" id="draft-indicator"></div>
                </div>
                <div id="chat-actions">
                  <div class="small" id="session-indicator">Not signed in</div>
                  <div class="pill-row">
                    <button type="button" class="ghost voice-btn" id="voice-input-btn" aria-label="Voice input" title="Hold to record">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                        <line x1="12" y1="19" x2="12" y2="23"/>
                        <line x1="8" y1="23" x2="16" y2="23"/>
                      </svg>
                    </button>
                    <button type="button" class="ghost voice-btn" id="voice-output-btn" aria-label="Read aloud" title="Read last response">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                      </svg>
                    </button>
                    <button type="button" class="ghost" id="new-thread-secondary">Reset</button>
                    <button type="submit" class="primary" id="send-btn">Send</button>
                    <button type="button" class="ghost hidden" id="stop-stream-btn" title="Stop generating">Stop</button>
                  </div>
                </div>
              </form>
              <div id="admin-warning" role="status"></div>

              <div class="divider"></div>
              <section id="preferences-section" aria-label="Preference feedback" class="panel-section collapsed">
                <div class="section-header clickable" id="preferences-toggle">
                  <h3>Preferences <span class="toggle-icon">+</span></h3>
                  <div class="pill-row">
                    <button type="button" class="ghost" id="thumbs-up" aria-label="Thumbs up">+1</button>
                    <button type="button" class="ghost" id="thumbs-down" aria-label="Thumbs down">-1</button>
                  </div>
                </div>
                <div class="section-content">
                  <p class="subtext" id="preference-hint">Send feedback on the latest assistant response.</p>
                  <div class="field textarea-wrap">
                    <label for="preference-notes">Notes (optional)</label>
                    <textarea id="preference-notes" rows="2" placeholder="What worked or what should change?"></textarea>
                  </div>
                  <div class="meta" id="preference-target"></div>
                  <pre id="preference-meta" class="code-block" aria-live="polite"></pre>
                  <pre id="preference-routing" class="code-block" aria-live="polite"></pre>
                  <div class="small" id="preference-status"></div>
                </div>
              </section>
            </div>
          </section>

          <!-- Contexts Tab -->
          <section class="tab-panel" id="contexts-tab" aria-label="Context management">
            <div class="panel">
              <div class="section-header">
                <h2>Knowledge Contexts</h2>
                <div class="pill-row">
                  <button class="minor" id="refresh-contexts">Refresh</button>
                </div>
              </div>
              <p class="subtext">Create and manage knowledge contexts for RAG-powered conversations.</p>

              <div class="divider"></div>

              <h3>Create new context</h3>
              <div class="input-grid">
                <div class="field">
                  <label for="new-context-name">Name</label>
                  <input type="text" id="new-context-name" placeholder="My Project Docs" required />
                </div>
                <div class="field">
                  <label for="new-context-description">Description</label>
                  <input type="text" id="new-context-description" placeholder="Documentation for my project" />
                </div>
              </div>
              <div class="pill-row mb-14">
                <button class="primary" id="create-context-btn">Create Context</button>
              </div>
              <div id="context-create-status" class="small" role="status"></div>

              <div class="divider"></div>

              <h3>Your contexts</h3>
              <div id="contexts-list" class="contexts-list">
                <div class="empty">No contexts yet. Create one above.</div>
              </div>

              <div class="divider"></div>

              <h3>Context details</h3>
              <div id="context-details" class="context-details">
                <div class="empty">Select a context to view details</div>
              </div>

              <div class="divider"></div>

              <h3>Context Sources</h3>
              <p class="subtext">Filesystem paths that have been ingested into this context.</p>
              <div id="context-sources-list" class="context-sources">
                <div class="empty">Select a context to view sources</div>
              </div>

              <div id="add-source-section" class="hidden">
                <div class="divider"></div>
                <h3>Add Source</h3>
                <p class="subtext">Add a filesystem path to ingest into this context.</p>
                <form id="add-source-form">
                  <div class="input-grid">
                    <div class="field">
                      <label for="source-path">Filesystem Path</label>
                      <input type="text" id="source-path" placeholder="/path/to/documents" required />
                    </div>
                    <div class="field">
                      <label for="source-recursive">
                        <input type="checkbox" id="source-recursive" checked />
                        Recursive (include subdirectories)
                      </label>
                    </div>
                  </div>
                  <div class="pill-row">
                    <button type="submit" class="primary" id="add-source-btn">Add Source</button>
                  </div>
                </form>
                <div id="add-source-status" class="small" role="status"></div>
              </div>
            </div>
          </section>

          <!-- Artifacts Tab -->
          <section class="tab-panel" id="artifacts-tab" aria-label="Artifact browser">
            <div class="panel">
              <div class="section-header">
                <h2>Artifacts</h2>
                <div class="pill-row">
                  <button class="minor" id="refresh-artifacts">Refresh</button>
                </div>
              </div>
              <p class="subtext">Browse and inspect system artifacts: workflows, policies, adapters, and tools.</p>

              <div class="input-grid mb-14">
                <div class="field compact">
                  <label for="artifact-type-filter">Filter by type</label>
                  <select id="artifact-type-filter">
                    <option value="">All types</option>
                    <option value="workflow">Workflows</option>
                    <option value="policy">Policies</option>
                    <option value="adapter">Adapters</option>
                    <option value="tool">Tools</option>
                  </select>
                </div>
                <div class="field compact">
                  <label for="artifact-visibility-filter">Visibility</label>
                  <select id="artifact-visibility-filter">
                    <option value="">All</option>
                    <option value="private">Private</option>
                    <option value="shared">Shared</option>
                    <option value="global">Global</option>
                  </select>
                </div>
              </div>

              <div id="artifacts-list" class="artifacts-list table-wrapper">
                <div class="empty">No artifacts found</div>
              </div>

              <div class="divider"></div>

              <h3>Artifact details</h3>
              <div id="artifact-details" class="artifact-details">
                <div class="empty">Select an artifact to view details</div>
              </div>

              <div class="divider"></div>

              <h3>Version history</h3>
              <div id="artifact-versions" class="artifact-versions">
                <div class="empty">Select an artifact to view version history</div>
              </div>
            </div>
          </section>

          <!-- Tools Tab -->
          <section class="tab-panel" id="tools-tab" aria-label="Tools and Workflows">
            <div class="panel">
              <div class="section-header">
                <h2>Tools & Workflows</h2>
                <div class="pill-row">
                  <button class="minor" id="refresh-tools">Refresh</button>
                </div>
              </div>
              <p class="subtext">Browse available tools and workflows. Invoke tools directly or manage workflow configurations.</p>

              <div class="divider"></div>

              <h3>Available Tools</h3>
              <p class="subtext">System-registered tool specifications that can be invoked in workflows.</p>
              <div id="tools-list" class="tools-list">
                <div class="empty">Loading tools...</div>
              </div>

              <div class="divider"></div>

              <h3>Tool Details</h3>
              <div id="tool-details" class="tool-details">
                <div class="empty">Select a tool to view details and invoke it</div>
              </div>

              <div class="divider"></div>

              <h3>Invoke Tool</h3>
              <div id="tool-invoke-section" class="hidden">
                <form id="tool-invoke-form">
                  <div class="field">
                    <label for="tool-invoke-input">Input (JSON)</label>
                    <textarea id="tool-invoke-input" rows="4" placeholder='{"message": "Hello"}'></textarea>
                  </div>
                  <div class="pill-row">
                    <button type="submit" class="primary" id="tool-invoke-btn">Invoke</button>
                  </div>
                </form>
                <div id="tool-invoke-status" class="small" role="status"></div>
                <div id="tool-invoke-result" class="code-block" style="display: none;"></div>
              </div>
              <div id="tool-invoke-placeholder" class="empty">Select a tool above to invoke it</div>

              <div class="divider"></div>

              <h3>Workflows</h3>
              <p class="subtext">Active workflow configurations for routing and processing messages.</p>
              <div id="workflows-list" class="workflows-list">
                <div class="empty">Loading workflows...</div>
              </div>

              <div class="divider"></div>

              <h3>Workflow Details</h3>
              <div id="workflow-details" class="workflow-details">
                <div class="empty">Select a workflow to view its configuration</div>
              </div>
            </div>
          </section>

          <!-- Insights Tab -->
          <section class="tab-panel" id="insights-tab" aria-label="Preference Insights">
            <div class="panel">
              <div class="section-header">
                <h2>Preference Insights</h2>
                <div class="pill-row">
                  <button class="minor" id="refresh-insights">Refresh</button>
                </div>
              </div>
              <p class="subtext">View your preference history and insights about how your feedback shapes model behavior.</p>

              <div class="divider"></div>

              <h3>Summary</h3>
              <div id="insights-summary" class="insights-summary">
                <div class="stats-grid">
                  <div class="stat-card">
                    <div class="stat-value" id="insights-total-events">-</div>
                    <div class="stat-label">Total Events</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-value" id="insights-positive-count">-</div>
                    <div class="stat-label">Positive</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-value" id="insights-negative-count">-</div>
                    <div class="stat-label">Negative</div>
                  </div>
                  <div class="stat-card">
                    <div class="stat-value" id="insights-neutral-count">-</div>
                    <div class="stat-label">Neutral</div>
                  </div>
                </div>
              </div>

              <div class="divider"></div>

              <h3>Top Adapters</h3>
              <p class="subtext">Adapters that have received the most positive feedback.</p>
              <div id="insights-top-adapters" class="insights-adapters">
                <div class="empty">No adapter data yet</div>
              </div>

              <div class="divider"></div>

              <h3>Recent Preferences</h3>
              <p class="subtext">Your most recent feedback events.</p>
              <div id="insights-recent-list" class="insights-recent">
                <div class="empty">No preference events yet</div>
              </div>

              <div class="divider"></div>

              <h3>Clusters</h3>
              <p class="subtext">Semantic clusters identified from your preferences. These represent emergent skill areas.</p>
              <div id="insights-clusters" class="insights-clusters">
                <div class="empty">No clusters identified yet</div>
              </div>
            </div>
          </section>

          <!-- Settings Tab -->
          <section class="tab-panel" id="settings-tab" aria-label="User settings">
            <div class="panel">
              <div class="section-header">
                <h2>Settings</h2>
              </div>
              <p class="subtext">Configure your preferences and account settings.</p>

              <div class="divider"></div>

              <h3>Session information</h3>
              <div class="settings-grid">
                <div class="setting-item">
                  <span class="setting-label">User ID</span>
                  <span class="setting-value" id="setting-user-id">-</span>
                </div>
                <div class="setting-item">
                  <span class="setting-label">Role</span>
                  <span class="setting-value" id="setting-role">-</span>
                </div>
                <div class="setting-item">
                  <span class="setting-label">Tenant</span>
                  <span class="setting-value" id="setting-tenant">-</span>
                </div>
                <div class="setting-item">
                  <span class="setting-label">Session ID</span>
                  <span class="setting-value monospace" id="setting-session-id">-</span>
                </div>
              </div>

              <div class="divider"></div>

              <h3>Local storage</h3>
              <p class="subtext">Draft messages are saved locally in your browser.</p>
              <div class="pill-row">
                <button class="minor" id="clear-drafts-btn">Clear saved drafts</button>
                <button class="ghost" id="export-drafts-btn">Export drafts</button>
              </div>
              <div id="drafts-status" class="small" role="status"></div>

              <div class="divider"></div>

              <h3>Upload limits</h3>
              <div class="settings-grid">
                <div class="setting-item">
                  <span class="setting-label">Max file size</span>
                  <span class="setting-value" id="setting-max-upload">Loading...</span>
                </div>
                <div class="setting-item">
                  <span class="setting-label">Allowed types</span>
                  <span class="setting-value" id="setting-allowed-types">.txt, .md, .pdf, .json, .csv, .yaml</span>
                </div>
              </div>

              <div class="divider"></div>

              <h3>About</h3>
              <div class="settings-grid">
                <div class="setting-item">
                  <span class="setting-label">Version</span>
                  <span class="setting-value" id="setting-version">-</span>
                </div>
                <div class="setting-item">
                  <span class="setting-label">Build</span>
                  <span class="setting-value monospace" id="setting-build">-</span>
                </div>
              </div>

              <!-- Admin Settings Section (only visible to admins) -->
              <div id="admin-settings-section" style="display: none;">
                <div class="divider"></div>
                <h3>Admin Settings</h3>
                <p class="subtext">System-wide settings (admin only). Changes take effect immediately.</p>

                <div class="form-group">
                  <label for="admin-default-page-size">Default page size</label>
                  <input type="number" id="admin-default-page-size" min="1" max="1000" value="100" />
                  <span class="small">Default number of items per page (1-1000)</span>
                </div>

                <div class="form-group">
                  <label for="admin-max-page-size">Max page size</label>
                  <input type="number" id="admin-max-page-size" min="1" max="1000" value="500" />
                  <span class="small">Maximum allowed page size (1-1000)</span>
                </div>

                <div class="form-group">
                  <label for="admin-default-conversations-limit">Default conversations limit</label>
                  <input type="number" id="admin-default-conversations-limit" min="1" max="500" value="50" />
                  <span class="small">Default limit for conversation list (1-500)</span>
                </div>

                <div class="pill-row" style="margin-top: 1rem;">
                  <button class="primary" id="save-admin-settings-btn">Save settings</button>
                  <button class="ghost" id="reload-admin-settings-btn">Reload</button>
                </div>
                <div id="admin-settings-status" class="small" role="status"></div>

                <!-- Users Management -->
                <div class="divider"></div>
                <h3>Users Management</h3>
                <p class="subtext">Manage system users, roles, and permissions.</p>

                <div class="pill-row mb-12">
                  <button class="ghost" id="refresh-users-btn">Refresh</button>
                  <button class="primary" id="show-add-user-btn">Add User</button>
                </div>

                <div id="add-user-form-section" class="hidden">
                  <div class="input-grid">
                    <div class="field">
                      <label for="new-user-email">Email</label>
                      <input type="email" id="new-user-email" placeholder="user@example.com" required />
                    </div>
                    <div class="field">
                      <label for="new-user-password">Password</label>
                      <input type="password" id="new-user-password" placeholder="Strong password" required />
                    </div>
                    <div class="field">
                      <label for="new-user-role">Role</label>
                      <select id="new-user-role">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                      </select>
                    </div>
                  </div>
                  <div class="pill-row">
                    <button class="primary" id="create-user-btn">Create User</button>
                    <button class="ghost" id="cancel-add-user-btn">Cancel</button>
                  </div>
                  <div id="create-user-status" class="small" role="status"></div>
                </div>

                <div class="table-wrapper">
                  <table class="table" id="users-table">
                    <thead>
                      <tr>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Tenant</th>
                        <th>Created</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="users-table-body">
                      <tr><td colspan="5" class="empty">Loading users...</td></tr>
                    </tbody>
                  </table>
                </div>

                <!-- Adapters List -->
                <div class="divider"></div>
                <h3>Adapters</h3>
                <p class="subtext">Active LoRA adapters in the system.</p>

                <div class="pill-row mb-12">
                  <button class="ghost" id="refresh-adapters-btn">Refresh</button>
                </div>

                <div class="table-wrapper">
                  <table class="table" id="adapters-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>User</th>
                        <th>Cluster</th>
                        <th>Model</th>
                        <th>Created</th>
                      </tr>
                    </thead>
                    <tbody id="adapters-table-body">
                      <tr><td colspan="5" class="empty">Loading adapters...</td></tr>
                    </tbody>
                  </table>
                </div>

                <!-- Storage Objects -->
                <div class="divider"></div>
                <h3>Storage Objects</h3>
                <p class="subtext">Files and objects stored in the system.</p>

                <div class="pill-row mb-12">
                  <button class="ghost" id="refresh-objects-btn">Refresh</button>
                </div>

                <div class="table-wrapper">
                  <table class="table" id="objects-table">
                    <thead>
                      <tr>
                        <th>Key</th>
                        <th>Bucket</th>
                        <th>Size</th>
                        <th>Type</th>
                        <th>Created</th>
                      </tr>
                    </thead>
                    <tbody id="objects-table-body">
                      <tr><td colspan="5" class="empty">Loading objects...</td></tr>
                    </tbody>
                  </table>
                </div>

                <!-- Config Patches -->
                <div class="divider"></div>
                <h3>Config Patches</h3>
                <p class="subtext">Review and manage proposed artifact configuration changes.</p>

                <div class="pill-row mb-12">
                  <button class="ghost" id="refresh-patches-btn">Refresh</button>
                  <select id="patches-status-filter">
                    <option value="">All statuses</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                    <option value="applied">Applied</option>
                  </select>
                </div>

                <div class="table-wrapper">
                  <table class="table" id="patches-table">
                    <thead>
                      <tr>
                        <th>ID</th>
                        <th>Artifact</th>
                        <th>Proposer</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="patches-table-body">
                      <tr><td colspan="6" class="empty">Loading patches...</td></tr>
                    </tbody>
                  </table>
                </div>

                <!-- Patch Details Modal -->
                <div id="patch-details-section" class="hidden">
                  <div class="divider"></div>
                  <h4>Patch Details</h4>
                  <div id="patch-details-content" class="patch-details">
                    <!-- Filled by JavaScript -->
                  </div>
                  <div class="pill-row mt-12">
                    <button class="primary" id="approve-patch-btn">Approve</button>
                    <button class="ghost" id="reject-patch-btn">Reject</button>
                    <button class="minor" id="apply-patch-btn" disabled>Apply</button>
                  </div>
                  <div id="patch-action-status" class="small" role="status"></div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>
  </body>
</html>
